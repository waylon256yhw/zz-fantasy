# ä»»åŠ¡ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ğŸ¯ è®¾è®¡åŸåˆ™

**æ ¸å¿ƒç†å¿µï¼šç®€åŒ–AIè´Ÿæ‹…ï¼Œç¨‹åºè‡ªåŠ¨ç®¡ç†**

1. **æ‰€æœ‰ä»»åŠ¡é¢„å®šä¹‰** - ä»»åŠ¡å¸¸é‡åº“ï¼Œä¸å…è®¸è¿è¡Œæ—¶åˆ›å»º
2. **AIåªå†™æ•…äº‹** - AIä¸éœ€è¦ç®¡ç†ä»»åŠ¡çŠ¶æ€ã€åˆ¤æ–­å®Œæˆæ¡ä»¶
3. **ç¨‹åºè‡ªåŠ¨æ£€æµ‹** - é€šè¿‡å…³é”®è¯æ£€æµ‹ä»»åŠ¡è¿›åº¦ï¼ˆç±»ä¼¼eventDetectorï¼‰
4. **ä¸€é”®æ¥å—** - ç‚¹å‡»"æ¥å—"æŒ‰é’®â†’è‡ªåŠ¨å‘é€useræ¶ˆæ¯â†’å…³é—­å¼¹çª—

---

## ğŸ“‹ ä»»åŠ¡æ•°æ®ç»“æ„

```typescript
interface Quest {
  id: string;              // å”¯ä¸€æ ‡è¯†
  title: string;           // ä»»åŠ¡æ ‡é¢˜
  description: string;     // ä»»åŠ¡æè¿°
  reward: number;          // é‡‘å¸å¥–åŠ±
  type: 'COMBAT' | 'GATHER' | 'EXPLORE';  // ä»»åŠ¡ç±»å‹
  rarity: 'Common' | 'Rare' | 'Urgent';   // ç¨€æœ‰åº¦
  status: 'available' | 'active' | 'completed';  // çŠ¶æ€
}
```

---

## ğŸ—‚ï¸ ä»»åŠ¡å¸¸é‡åº“

å®šä¹‰åœ¨ `constants.ts` çš„ `ALL_QUESTS` ä¸­ï¼š

```typescript
export const ALL_QUESTS: Record<string, Omit<Quest, 'status'>> = {
  SLIME_HUNT: {
    id: 'quest_slime',
    title: 'è®¨ä¼ï¼šå˜å¼‚å²è±å§†',
    description: 'è¥¿è¾¹æ£®æ—çš„å²è±å§†ä¼¼ä¹å—åˆ°äº†æŸç§é­”åŠ›çš„å½±å“å˜å¾—å·¨å¤§åŒ–äº†ï¼Œè¯·å‰å¾€è®¨ä¼ã€‚',
    reward: 500,
    type: 'COMBAT',
    rarity: 'Urgent',
  },
  // ... æ›´å¤šä»»åŠ¡
};
```

### å½“å‰ä»»åŠ¡åˆ—è¡¨

1. **SLIME_HUNT** - è®¨ä¼ï¼šå˜å¼‚å²è±å§†ï¼ˆ500Gï¼Œç´§æ€¥ï¼‰
2. **HERB_GATHER** - é‡‡é›†ï¼šæœˆå…‰è‰ï¼ˆ200Gï¼Œæ™®é€šï¼‰
3. **GOBLIN_PATROL** - å·¡é€»ï¼šå“¥å¸ƒæ—è¥åœ°ï¼ˆ300Gï¼Œæ™®é€šï¼‰
4. **ANCIENT_RUINS** - æ¢ç´¢ï¼šå¤ä»£é—è¿¹ï¼ˆ800Gï¼Œç¨€æœ‰ï¼‰

---

## ğŸ® ä»»åŠ¡æµç¨‹

### 1. æ¥å—ä»»åŠ¡

**ç”¨æˆ·æ“ä½œï¼š**
1. ç‚¹å‡»"å…¬ä¼š"æŒ‰é’®æ‰“å¼€ä»»åŠ¡åˆ—è¡¨
2. æŸ¥çœ‹å¯ç”¨ä»»åŠ¡
3. ç‚¹å‡»"æ¥å—"æŒ‰é’®

**ç³»ç»Ÿå¤„ç†ï¼š**
```typescript
onAcceptQuest={(questId, questTitle) => {
  // 1. æ·»åŠ åˆ°activeQuests
  acceptQuest(questId);

  // 2. å…³é—­å¼¹çª—
  setActiveSheet(null);

  // 3. è‡ªåŠ¨å‘é€useræ¶ˆæ¯
  setInput(`æˆ‘æ¥å—äº†ä»»åŠ¡ï¼š${questTitle}`);
  setTimeout(() => {
    handleAction(`æˆ‘æ¥å—äº†ä»»åŠ¡ï¼š${questTitle}`);
  }, 100);
}}
```

**AIæ”¶åˆ°çš„æ¶ˆæ¯ï¼š**
```
ç”¨æˆ·: æˆ‘æ¥å—äº†ä»»åŠ¡ï¼šè®¨ä¼ï¼šå˜å¼‚å²è±å§†
```

**AIè‡ªç„¶å“åº”ï¼ˆç¤ºä¾‹ï¼‰ï¼š**
```
ä½ åœ¨å…¬ä¼šæ¥è¿‡ç¾Šçš®çº¸ä»»åŠ¡ä¹¦ï¼Œä¸Šé¢æç»˜ç€ä¸€åªå·¨å¤§çš„å²è±å§†ã€‚ã€Œè¥¿è¾¹æ£®æ—æœ€è¿‘æœ‰äº›ä¸å¤ªå¹³å‘¢ã€ï¼Œå…¬ä¼šæ¥å¾…å‘˜
æé†’é“ï¼Œã€Œå°å¿ƒç‚¹ï¼Œé‚£åªå²è±å§†æ¯”å¹³å¸¸çš„è¦å¤§å¾—å¤šã€‚ã€
```

### 2. ä»»åŠ¡è¿›è¡Œä¸­

**æ˜¾ç¤ºçŠ¶æ€ï¼š**
- ä»»åŠ¡åœ¨å…¬ä¼šç•Œé¢æ˜¾ç¤ºä¸º"è¿›è¡Œä¸­"ï¼ˆé»„è‰²è¾¹æ¡†ï¼Œâ³å›¾æ ‡ï¼‰
- Character.activeQuestsæ•°ç»„åŒ…å«è¯¥ä»»åŠ¡ID

**AIæ— éœ€çŸ¥é“ï¼š**
- AIä¸éœ€è¦ä¸»åŠ¨æåŠä»»åŠ¡è¿›åº¦
- AIåªéœ€è‡ªç„¶å™è¿°å†’é™©æ•…äº‹
- ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹å…³é”®äº‹ä»¶

### 3. ä»»åŠ¡å®Œæˆæ£€æµ‹

**ç¨‹åºè‡ªåŠ¨æ£€æµ‹ï¼ˆæœªæ¥å®ç°ï¼‰ï¼š**
```typescript
// ç±»ä¼¼ eventDetector.ts
export function detectQuestCompletion(aiResponse: string, activeQuests: string[]): string[] {
  const completedQuestIds: string[] = [];

  // æ£€æµ‹å²è±å§†ä»»åŠ¡
  if (activeQuests.includes('quest_slime')) {
    if (/å‡»è´¥.*å²è±å§†|æ¶ˆç­.*å²è±å§†|å²è±å§†.*å€’ä¸‹/.test(aiResponse)) {
      completedQuestIds.push('quest_slime');
    }
  }

  // æ£€æµ‹é‡‡é›†ä»»åŠ¡
  if (activeQuests.includes('quest_herb')) {
    if (/é‡‡é›†.*æœˆå…‰è‰|è·å¾—.*æœˆå…‰è‰/.test(aiResponse)) {
      completedQuestIds.push('quest_herb');
    }
  }

  return completedQuestIds;
}
```

**è‡ªåŠ¨å¤„ç†ï¼š**
1. æ£€æµ‹åˆ°å®Œæˆå…³é”®è¯
2. è°ƒç”¨ `completeQuest(questId)`
3. ç§»é™¤activeQuestsï¼Œæ·»åŠ completedQuests
4. è‡ªåŠ¨æ·»åŠ é‡‘å¸å¥–åŠ±
5. å¯é€‰ï¼šæ˜¾ç¤º"ä»»åŠ¡å®Œæˆ"é€šçŸ¥

---

## ğŸ—ï¸ Characteræ•°æ®æ‰©å±•

```typescript
interface Character {
  // ... å…¶ä»–å­—æ®µ
  activeQuests: string[];      // æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ID
  completedQuests: string[];   // å·²å®Œæˆçš„ä»»åŠ¡ID
}
```

**åˆå§‹å€¼ï¼š**
```typescript
{
  activeQuests: [],
  completedQuests: [],
}
```

---

## ğŸ”§ APIå‡½æ•°

### GameContextæä¾›çš„å‡½æ•°

```typescript
const { acceptQuest, completeQuest } = useGame();

// æ¥å—ä»»åŠ¡
acceptQuest('quest_slime');

// å®Œæˆä»»åŠ¡
completeQuest('quest_slime');
```

### constants.tsæä¾›çš„è¾…åŠ©å‡½æ•°

```typescript
// è·å–å¯ç”¨ä»»åŠ¡ï¼ˆæœªæ¥å—ä¸”æœªå®Œæˆï¼‰
getAvailableQuests(activeQuestIds, completedQuestIds): Quest[]

// è·å–æ´»è·ƒä»»åŠ¡
getActiveQuests(activeQuestIds): Quest[]

// è·å–å·²å®Œæˆä»»åŠ¡
getCompletedQuests(completedQuestIds): Quest[]
```

---

## ğŸ¨ UIæ˜¾ç¤ºè§„åˆ™

### ä»»åŠ¡åˆ—è¡¨ï¼ˆGuildSheetï¼‰

**å¯ç”¨ä»»åŠ¡ï¼ˆAvailableï¼‰ï¼š**
- ç™½è‰²èƒŒæ™¯
- å·¦ä¾§å½©è‰²è¾¹æ¡†ï¼š
  - ğŸ”´ ç´§æ€¥ä»»åŠ¡ï¼ˆUrgentï¼‰ï¼šç²‰çº¢è‰² `border-[#FF9FAA]`
  - ğŸ”µ ç¨€æœ‰ä»»åŠ¡ï¼ˆRareï¼‰ï¼šå¤©è“è‰² `border-[#89CFF0]`
  - ğŸŸ¡ æ™®é€šä»»åŠ¡ï¼ˆCommonï¼‰ï¼šé»„è‰² `border-[#FFD166]`
- æ˜¾ç¤ºå¥–åŠ±é‡‘å¸
- **å¯ç‚¹å‡»"æ¥å—"æŒ‰é’®**

**è¿›è¡Œä¸­ä»»åŠ¡ï¼ˆActiveï¼‰ï¼š**
- æµ…é»„èƒŒæ™¯ `bg-[#FFF9F0]`
- é»„è‰²å·¦è¾¹æ¡†
- æ˜¾ç¤º"â³ è¿›è¡Œä¸­"æ ‡ç­¾
- **æ— æŒ‰é’®**

**å·²å®Œæˆä»»åŠ¡ï¼ˆCompletedï¼‰ï¼š**
- ç™½è‰²èƒŒæ™¯ï¼ŒåŠé€æ˜ `opacity-60`
- ç°è‰²å·¦è¾¹æ¡†
- æ ‡é¢˜åˆ é™¤çº¿
- æ˜¾ç¤º"âœ“ å·²å®Œæˆ"æ ‡ç­¾
- **æ— æŒ‰é’®**

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ‰€æœ‰ä»»åŠ¡å¿…é¡»åœ¨ `ALL_QUESTS` ä¸­é¢„å®šä¹‰**
2. **AIä¸è´Ÿè´£ç®¡ç†ä»»åŠ¡çŠ¶æ€** - åªå†™æ•…äº‹ï¼Œä¸åˆ¤æ–­ä»»åŠ¡å®Œæˆ
3. **ç¨‹åºè´Ÿè´£æ£€æµ‹å®Œæˆæ¡ä»¶** - é€šè¿‡å…³é”®è¯åŒ¹é…
4. **æ¥å—ä»»åŠ¡ä¼šè‡ªåŠ¨å‘é€æ¶ˆæ¯** - ç”¨æˆ·æ— éœ€æ‰‹åŠ¨è¾“å…¥
5. **ä»»åŠ¡å¥–åŠ±ç›®å‰è‡ªåŠ¨æ·»åŠ ** - å®Œæˆæ—¶è‡ªåŠ¨åŠ é‡‘å¸ï¼ˆæœªæ¥å¯æ‰©å±•ç‰©å“å¥–åŠ±ï¼‰

---

## ğŸš€ æœªæ¥æ‰©å±•

### 1. ä»»åŠ¡å®Œæˆæ£€æµ‹å™¨

åˆ›å»º `src/utils/questDetector.ts`ï¼š
- ç±»ä¼¼ `eventDetector.ts`
- æ£€æµ‹AIè¾“å‡ºä¸­çš„ä»»åŠ¡å®Œæˆå…³é”®è¯
- è‡ªåŠ¨è§¦å‘ `completeQuest()`

### 2. ä»»åŠ¡å¥–åŠ±ç³»ç»Ÿ

æ‰©å±•Questæ¥å£ï¼š
```typescript
interface Quest {
  // ... ç°æœ‰å­—æ®µ
  rewards: {
    gold?: number;
    items?: Array<keyof typeof ALL_ITEMS>;
    exp?: number;
  };
}
```

### 3. ä»»åŠ¡é“¾ç³»ç»Ÿ

```typescript
interface Quest {
  // ... ç°æœ‰å­—æ®µ
  prerequisite?: string;  // å‰ç½®ä»»åŠ¡ID
  nextQuest?: string;     // åç»­ä»»åŠ¡ID
}
```

### 4. ä»»åŠ¡å¤±è´¥æœºåˆ¶

```typescript
interface Quest {
  // ... ç°æœ‰å­—æ®µ
  status: 'available' | 'active' | 'completed' | 'failed';
  failCondition?: string;  // å¤±è´¥æ¡ä»¶æè¿°
}
```

---

## ğŸ“Š æ•°æ®æµå›¾

```
ç”¨æˆ·ç‚¹å‡»"æ¥å—"
    â†“
acceptQuest(questId)
    â†“
activeQuests.push(questId)
    â†“
è‡ªåŠ¨å‘é€æ¶ˆæ¯ï¼š"æˆ‘æ¥å—äº†ä»»åŠ¡ï¼šXXX"
    â†“
AIè‡ªç„¶å“åº”ï¼ˆå™è¿°æ¥ä»»åŠ¡çš„åœºæ™¯ï¼‰
    â†“
ç”¨æˆ·ç»§ç»­å†’é™©ï¼ˆAIæ­£å¸¸å™äº‹ï¼‰
    â†“
ç¨‹åºæ£€æµ‹AIè¾“å‡ºï¼ˆquestDetectorï¼‰
    â†“
å‘ç°å®Œæˆå…³é”®è¯
    â†“
completeQuest(questId)
    â†“
activeQuestsç§»é™¤ â†’ completedQuestsæ·»åŠ 
    â†“
è‡ªåŠ¨æ·»åŠ å¥–åŠ±é‡‘å¸
```

---

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

1. **ç®€å•** - AIæ— éœ€ç†è§£ä»»åŠ¡ç³»ç»Ÿï¼Œåªå†™æ•…äº‹
2. **å¯é ** - ç¨‹åºæ§åˆ¶çŠ¶æ€ï¼Œä¸ä¾èµ–AIè¾“å‡ºæ ¼å¼
3. **æµç•…** - æ¥å—ä»»åŠ¡è‡ªåŠ¨è§¦å‘å¯¹è¯ï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥
4. **æ‰©å±•æ€§** - é¢„å®šä¹‰å¸¸é‡ï¼Œæ˜“äºæ·»åŠ æ–°ä»»åŠ¡
5. **ä¸€è‡´æ€§** - æ‰€æœ‰ä»»åŠ¡éµå¾ªç›¸åŒçš„æ•°æ®ç»“æ„å’Œæµç¨‹
